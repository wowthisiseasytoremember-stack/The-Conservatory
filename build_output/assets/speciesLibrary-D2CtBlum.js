import{d as n,a as h,g as l,s as m,b as y}from"./index-DINgooMC.js";class d{constructor(){this.cache=new Map}async get(a,r){var c;const e=this.getKey(a,r);if(this.cache.has(e))return console.log(`[SpeciesLibrary] Cache hit for ${e}`),this.cache.get(e);try{const s=n(h,"species_library",e),o=await l(s);if(o.exists()){const t=o.data(),i={id:t.id,commonName:t.commonName,scientificName:t.scientificName,morphVariant:t.morphVariant,enrichmentData:t.enrichmentData,enrichedAt:((c=t.enrichedAt)==null?void 0:c.toDate())||new Date};return this.cache.set(e,i),console.log(`[SpeciesLibrary] Firestore hit for ${e}`),i}}catch(s){console.error("[SpeciesLibrary] Error loading from Firestore:",s)}return null}async save(a){const r=this.getKey(a.commonName,a.morphVariant);this.cache.set(r,a),console.log(`[SpeciesLibrary] Cached ${r}`);try{const e=n(h,"species_library",r);await m(e,{...a,enrichedAt:y()},{merge:!0}),console.log(`[SpeciesLibrary] Saved to Firestore: ${r}`)}catch(e){console.error("[SpeciesLibrary] Failed to save to Firestore:",e)}}getKey(a,r){const e=a.toLowerCase().trim(),c=(r==null?void 0:r.toLowerCase().trim())||"";return c?`${e}:${c}`:e}clearCache(){this.cache.clear(),console.log("[SpeciesLibrary] Cache cleared")}}const b=new d;export{b as speciesLibrary};
