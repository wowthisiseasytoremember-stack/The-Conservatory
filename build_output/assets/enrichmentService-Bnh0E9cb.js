const $="https://en.wikipedia.org/w/api.php",k="https://api.gbif.org/v1",N="https://api.inaturalist.org/v1",D={async searchGBIF(c){try{const t=await(await fetch(`${k}/species/match?name=${encodeURIComponent(c)}`)).json();if(!t.usageKey)return null;const e=await(await fetch(`${k}/species/${t.usageKey}`)).json();return{scientificName:e.scientificName,taxonomy:{kingdom:e.kingdom,phylum:e.phylum,order:e.order,family:e.family,genus:e.genus}}}catch(o){return console.warn("GBIF Search Failed",o),null}},async searchWikipedia(c){var o,t,i,e;try{const r=`${$}?action=query&list=search&srsearch=${encodeURIComponent(c)}&format=json&origin=*`,u=await(await fetch(r)).json();if(!((t=(o=u.query)==null?void 0:o.search)!=null&&t.length))return null;const m=u.query.search[0].title,w=`${$}?action=query&prop=extracts&exintro&explaintext&titles=${encodeURIComponent(m)}&format=json&origin=*`,p=(i=(await(await fetch(w)).json()).query)==null?void 0:i.pages,q=Object.keys(p)[0];return{description:(e=p[q])==null?void 0:e.extract,commonName:m}}catch(r){return console.warn("Wiki Search Failed",r),null}},async searchiNaturalist(c){var o;try{const t=`${N}/taxa?q=${encodeURIComponent(c)}`,e=await(await fetch(t)).json();if(!((o=e.results)!=null&&o.length))return null;const r=e.results[0];return{commonName:r.preferred_common_name,scientificName:r.name,images:r.default_photo?[r.default_photo.medium_url]:[]}}catch(t){return console.warn("iNaturalist Search Failed",t),null}},async scrapeAquasabi(c){var r,R,u,m,w,C,I;const o="https://www.aquasabi.com",t=c.toLowerCase().replace(/ /g,"-").replace(/'/g,""),i=`${o}/${t}`,e="https://api.allorigins.win/get?url=";try{const q=await(await fetch(`${e}${encodeURIComponent(i)}`)).json();if(!q.contents)throw new Error("No content from proxy");const n=new DOMParser().parseFromString(q.contents,"text/html"),j=(R=(r=n.querySelector("#description-1 p"))==null?void 0:r.textContent)==null?void 0:R.trim(),A=Array.from(n.querySelectorAll("#flowgrow p")).map(s=>{var a;return(a=s.textContent)==null?void 0:a.trim()}).join(`

`),U=(m=(u=n.querySelector("#general p"))==null?void 0:u.textContent)==null?void 0:m.trim(),l={};n.querySelectorAll("#view-group-culture tr").forEach(s=>{var d,y,h,g;const a=(y=(d=s.querySelector("th"))==null?void 0:d.textContent)==null?void 0:y.trim(),f=(g=(h=s.querySelector("td"))==null?void 0:h.textContent)==null?void 0:g.trim();a&&f&&(l[a]=f)}),n.querySelectorAll("#view-group-general .row").forEach(s=>{var d,y,h,g;const a=(y=(d=s.querySelector(".label"))==null?void 0:d.textContent)==null?void 0:y.trim(),f=(g=(h=s.querySelector(".value"))==null?void 0:h.textContent)==null?void 0:g.trim();a&&f&&(l[a]=f)});let S="unknown";n.querySelector('img[src*="foreground"]')?S="foreground":n.querySelector('img[src*="middleground"]')?S="midground":n.querySelector('img[src*="background"]')&&(S="background");let x="unknown";return(n.querySelector(".difficulty-easy")||(w=l.Difficulty)!=null&&w.toLowerCase().includes("easy"))&&(x="easy"),(n.querySelector(".difficulty-medium")||(C=l.Difficulty)!=null&&C.toLowerCase().includes("medium"))&&(x="medium"),(n.querySelector(".difficulty-hard")||(I=l.Difficulty)!=null&&I.toLowerCase().includes("hard"))&&(x="hard"),{details:{description:j||"",notes:A||"",maintenance:U||""},traits:{...l,placement:S,difficulty:x}}}catch(p){return console.warn("Aquasabi Scrape Failed",p),null}}};export{D as enrichmentService};
